# 常用操作回顾

## 安装

```bash
sudo apt-get update
sudo apt-get install postgresql postgresql-client

```

## 登录

```bash

sudo -u postgres psql

```

## nginx 设置反向代理

```nginx
stream {
    upstream postgres_server {
        server 127.0.0.1:5432;
    }
    server {
        listen 17018;
        proxy_pass postgres_server;
        ssl_preread on;
    }
}
```

```bash
# 如果设置了用户 mo7cc 并且 赋予了 mydb 权限 ，且密码为 asdasd55555
psql "host=127.0.0.1 port=5432 dbname=mydb user=mo7cc password=asdasd55555 sslmode=require"

# 远程
psql "host=db.mo7cc port=17018 dbname=mydb user=mo7cc password=asdasd55555 sslmode=require"
```

## 数据库 (DATABASE) 增删改查

```sql

-- 创建
CREATE DATABASE mydb;

-- 查看数据库列表
\l

-- 删除数据库列表
DROP DATABASE mydb;

-- 切换到新创建的数据库
\c mo7db

-- 查看当前数据库
SELECT current_database();

```

## 模式 (SCHEMA) 的增删改查

```sql
-- 基本创建（当前用户为所有者）
CREATE SCHEMA myschema;

-- 指定所有者（需有对应权限）
CREATE SCHEMA myschema AUTHORIZATION mo7cc;

-- 查看当前数据库所有模式
SELECT schema_name FROM information_schema.schemata;

-- 修改模式所有者
ALTER SCHEMA myschema OWNER TO mo7cc;

-- 重命名模式（PostgreSQL 12+ 支持）
ALTER SCHEMA myschema RENAME TO mynewschema;

-- 删除空模式 "test_schema"
DROP SCHEMA myschema;
```

> 模式为非必要操作，如果略过模式，则会默认使用 public 模式

## 表 (TABLE) 的增删改查

```sql
-- 后续操作默认使用这个模式, 可以理解为 进入 某个模式
SET search_path TO myschema;

-- 查看当前默认模式
SHOW search_path;

-- 创建表 students
CREATE TABLE IF NOT EXISTS students (
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,  -- 主键自增（PostgreSQL 语法）
    name VARCHAR(50) NOT NULL,  -- 姓名，必填，最长50字符
    age INT,  -- 年龄，可选（可空）
    gender CHAR(1)  -- 性别，M/F（单字符）
);

-- 当前模式下的所有表
\dt

--查看表结构
\d students

-- 给 students 表新增 "email" 字段
ALTER TABLE students
ADD COLUMN email VARCHAR(255) UNIQUE;

-- 删除表（若表不存在则不报错）
DROP TABLE IF EXISTS students;
```

## 数据的增删改查

```sql
-- 批量插入
INSERT INTO students (id, name, age, gender, email)
VALUES
    (1,'王五',30, 'm','wangwu@example.com'),
    (2,'赵六',28, 'f','zhaoliu@example.com' );

-- 查询所有字段和所有行  users 要带引号
SELECT * FROM students;

-- 限制结果（取前2条）
SELECT * FROM students LIMIT 2;

-- 分页查询（取2条，并跳过2条,即第3-4 条）
SELECT * FROM students LIMIT 2 OFFSET 2;

-- 把名为 "张三" 的学生年龄更新为 26
UPDATE students
SET age = 26
WHERE name = '张三';

-- 删除指定行（删除邮箱为zhaoliu@example.com的用户）
DELETE FROM students
WHERE email = 'zhaoliu@example.com';
```

## 用户 (ROLE) 与权限

```sql
-- 删除用户
DROP ROLE mo7cc;

-- 查看所有用户
\du
SELECT rolname FROM pg_roles;

-- 查看当前登录用户
SELECT current_user;

-- 创建用户
CREATE USER mo7cc WITH PASSWORD 'password';

-- 删除用户
DROP ROLE mo7cc;

-- 赋予超级用户权限
ALTER USER mo7cc WITH SUPERUSER;

-- mydb数据库的所有权限
GRANT ALL PRIVILEGES ON DATABASE mydb TO mo7cc;

-- 允许使用该模式
GRANT USAGE ON SCHEMA myschema TO mo7cc;

-- 授予该模式下所有现有表的全部权限
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA myschema TO mo7cc;

-- 授予该模式下未来创建的表的全部权限
ALTER DEFAULT PRIVILEGES IN SCHEMA myschema
GRANT ALL PRIVILEGES ON TABLES TO mo7cc;
```

## 客户端

DBeaver (社区免费开源)
https://blog.csdn.net/tennysonsky/article/details/122397486
https://dbeaver.io/download/

Navicat Premium Lite (界面简洁好用，商用免费版)
https://www.navicat.com.cn/products/navicat-premium-lite
